<!DOCTYPE html>
<html lang="en" dir="ltr">
<head>
  <meta charset="utf-8" />
  <title>howto:redirection_tutorial</title>
<meta name="generator" content="DokuWiki"/>
<meta name="robots" content="index,follow"/>
<meta name="keywords" content="howto,redirection_tutorial,bash,shell,scripting,tutorial,redirection,redirect,file,descriptor"/>
<link rel="search" type="application/opensearchdescription+xml" href="/lib/exe/opensearch.php" title="Bash Hackers Wiki"/>
<link rel="start" href="/"/>
<link rel="contents" href="/howto/redirection_tutorial?do=index" title="Sitemap"/>
<link rel="manifest" href="/lib/exe/manifest.php"/>
<link rel="alternate" type="application/rss+xml" title="Recent Changes" href="/feed.php"/>
<link rel="alternate" type="application/rss+xml" title="Current namespace" href="/feed.php?mode=list&amp;ns=howto"/>
<link rel="alternate" type="text/html" title="Plain HTML" href="/_export/xhtml/howto/redirection_tutorial"/>
<link rel="alternate" type="text/plain" title="Wiki Markup" href="/_export/raw/howto/redirection_tutorial"/>
<link rel="canonical" href="https://wiki.bash-hackers.org/howto/redirection_tutorial"/>
<link rel="stylesheet" type="text/css" href="/lib/exe/css.php?t=bootstrap3&amp;tseed=54923c3deda180f2db5bd755cd8fbf1a"/>
<!--[if gte IE 9]><!-->
<script type="text/javascript">/*<![CDATA[*/var NS='howto';var JSINFO = {"updatable":1,"userreplace":1,"default_macro_string":"","plugins":{"edittable":{"default columnwidth":""}},"move_renameokay":false,"isadmin":0,"isauth":0,"id":"howto:redirection_tutorial","namespace":"howto","ACT":"export_xhtml","useHeadingNavigation":1,"useHeadingContent":1};
/*!]]>*/</script>
<script type="text/javascript" charset="utf-8" src="/lib/exe/jquery.php?tseed=23f888679b4f1dc26eef34902aca964f"></script>
<script type="text/javascript" charset="utf-8" src="/lib/exe/js.php?t=bootstrap3&amp;tseed=54923c3deda180f2db5bd755cd8fbf1a"></script>
<!--<![endif]-->
</head>
<body>
<div class="dokuwiki export">
<!-- TOC START -->
<div id="dw__toc" class="dw__toc">
<h3 class="toggle">Table of Contents</h3>
<div>

<ul class="toc">
<li class="level1"><div class="li"><a href="#illustrated_redirection_tutorial">Illustrated Redirection Tutorial</a></div></li>
<li class="level1"><div class="li"><a href="#stdin_stdout_stderr">stdin, stdout, stderr</a></div></li>
<li class="level1"><div class="li"><a href="#simple_redirections">Simple Redirections</a></div>
<ul class="toc">
<li class="level2"><div class="li"><a href="#output_redirection_n_file">Output Redirection &quot;n&gt; file&quot;</a></div></li>
<li class="level2"><div class="li"><a href="#input_redirection_n_file">Input Redirection &quot;n&lt; file&quot;</a></div></li>
<li class="level2"><div class="li"><a href="#pipes">Pipes |</a></div></li>
</ul>
</li>
<li class="level1"><div class="li"><a href="#more_on_file_descriptors">More On File Descriptors</a></div>
<ul class="toc">
<li class="level2"><div class="li"><a href="#duplicating_file_descriptor_2_1">Duplicating File Descriptor 2&gt;&amp;1</a></div></li>
<li class="level2"><div class="li"><a href="#order_of_redirection_ie_file_2_1_vs_2_1_file">Order Of Redirection, i.e., &quot;&gt; file 2&gt;&amp;1&quot; vs. &quot;2&gt;&amp;1 &gt;file&quot;</a></div></li>
<li class="level2"><div class="li"><a href="#why_sed_sfoobarfile_file_doesn_t_work">Why sed &#039;s/foo/bar/&#039; file &gt;file Doesn&#039;t Work</a></div></li>
<li class="level2"><div class="li"><a href="#exec">exec</a></div></li>
<li class="level2"><div class="li"><a href="#closing_the_file_descriptors">Closing The File Descriptors</a></div></li>
</ul>
</li>
<li class="level1"><div class="li"><a href="#an_example">An Example</a></div></li>
<li class="level1"><div class="li"><a href="#syntax">Syntax</a></div>
<ul class="toc">
<li class="clear">
<ul class="toc">
<li class="level3"><div class="li"><a href="#a_note_on_style">A note on style</a></div></li>
</ul>
</li>
</ul>
</li>
<li class="level1"><div class="li"><a href="#conclusion">Conclusion</a></div></li>
<li class="level1"><div class="li"><a href="#see_also">See also</a></div></li>
<li class="level1"><div class="li"><a href="#discussion__section">Discussion</a></div></li>
</ul>
</div>
</div>
<!-- TOC END -->

<h1 class="sectionedit1" id="illustrated_redirection_tutorial">Illustrated Redirection Tutorial</h1>
<div class="level1">

<p>
This tutorial is not a complete guide to redirection, it will not
cover here docs, here strings, name pipes etcâ€¦ I just hope it&#039;ll help
you to understand what things like <code>3&gt;&amp;2</code>, <code>2&gt;&amp;1</code> or <code>1&gt;&amp;3-</code> do.
</p>

</div>
<!-- EDIT{&quot;target&quot;:&quot;section&quot;,&quot;name&quot;:&quot;Illustrated Redirection Tutorial&quot;,&quot;hid&quot;:&quot;illustrated_redirection_tutorial&quot;,&quot;codeblockOffset&quot;:0,&quot;secid&quot;:1,&quot;range&quot;:&quot;3-342&quot;} -->
<h1 class="sectionedit2" id="stdin_stdout_stderr">stdin, stdout, stderr</h1>
<div class="level1">

<p>
When Bash starts, normally, 3 file descriptors are opened, <code>0</code>, <code>1</code> and <code>2</code>
also known as standard input (<code>stdin</code>), standard output (<code>stdout</code>) and
standard error (<code>stderr</code>).
</p>

<p>
For example, with Bash running in a Linux terminal emulator, you&#039;ll see:
</p>

<p>
<pre class="code"># lsof +f g -ap $BASHPID -d 0,1,2
COMMAND   PID USER   FD   TYPE FILE-FLAG DEVICE SIZE/OFF NODE NAME
bash    12135 root    0u   CHR     RW,LG 136,13      0t0   16 /dev/pts/5
bash    12135 root    1u   CHR     RW,LG 136,13      0t0   16 /dev/pts/5
bash    12135 root    2u   CHR     RW,LG 136,13      0t0   16 /dev/pts/5</pre>

</p>

<p>
This <code>/dev/pts/5</code> is a pseudo terminal used to emulate a real
terminal. Bash reads (<code>stdin</code>) from this terminal and prints
via <code>stdout</code> and <code>stderr</code> to this terminal.
</p>

<p>
<pre class="code">                  ---       +-----------------------+
standard input   ( 0 ) ----&gt;| /dev/pts/5            |
                  ---       +-----------------------+

                  ---       +-----------------------+
standard output  ( 1 ) ----&gt;| /dev/pts/5            |
                  ---       +-----------------------+

                  ---       +-----------------------+
standard error   ( 2 ) ----&gt;| /dev/pts/5            |
                  ---       +-----------------------+</pre>

</p>

<p>
When a command, a compound command, a subshell etc. is executed, it inherits
these file descriptors. For instance <code>echo foo</code> will send the text <code>foo</code> to the file
descriptor <code>1</code> inherited from the shell, which is connected to <code>/dev/pts/5</code>.
</p>

</div>
<!-- EDIT{&quot;target&quot;:&quot;section&quot;,&quot;name&quot;:&quot;stdin, stdout, stderr&quot;,&quot;hid&quot;:&quot;stdin_stdout_stderr&quot;,&quot;codeblockOffset&quot;:0,&quot;secid&quot;:2,&quot;range&quot;:&quot;343-1904&quot;} -->
<h1 class="sectionedit3" id="simple_redirections">Simple Redirections</h1>
<div class="level1">

</div>
<!-- EDIT{&quot;target&quot;:&quot;section&quot;,&quot;name&quot;:&quot;Simple Redirections&quot;,&quot;hid&quot;:&quot;simple_redirections&quot;,&quot;codeblockOffset&quot;:2,&quot;secid&quot;:3,&quot;range&quot;:&quot;1905-1938&quot;} -->
<h2 class="sectionedit4" id="output_redirection_n_file">Output Redirection &quot;n&gt; file&quot;</h2>
<div class="level2">

<p>
<code>&gt;</code> is probably the simplest redirection.
</p>

<p>
<code>echo foo &gt; file</code>
</p>

<p>
the <code>&gt; file</code> after the command alters the file descriptors belonging to the
command <code>echo</code>. It changes the file descriptor <code>1</code> (<code>&gt; file</code> is the same as
<code>1&gt;file</code>) so that it points to the file <code>file</code>. They will look like:
</p>

<p>
<pre class="code">                  ---       +-----------------------+
standard input   ( 0 ) ----&gt;| /dev/pts/5            |
                  ---       +-----------------------+

                  ---       +-----------------------+
standard output  ( 1 ) ----&gt;| file                  |
                  ---       +-----------------------+

                  ---       +-----------------------+
standard error   ( 2 ) ----&gt;| /dev/pts/5            |
                  ---       +-----------------------+</pre>

</p>

<p>
Now characters written by our command, <code>echo</code>, that are sent to the
standard output, i.e., the file descriptor <code>1</code>, end up in the file
named <code>file</code>.
</p>

<p>
In the same way, command <code>2&gt; file</code> will change the standard error and
will make it point to <code>file</code>. Standard error is used by applications to print errors.
</p>

<p>
What will <code>command 3&gt; file</code> do? It will open a new file descriptor
pointing to <code>file</code>. The command will then start with:
</p>

<p>
<pre class="code">                  ---       +-----------------------+
standard input   ( 0 ) ----&gt;| /dev/pts/5            |
                  ---       +-----------------------+

                  ---       +-----------------------+
standard output  ( 1 ) ----&gt;| /dev/pts/5            |
                  ---       +-----------------------+

                  ---       +-----------------------+
standard error   ( 2 ) ----&gt;| /dev/pts/5            |
                  ---       +-----------------------+

                  ---       +-----------------------+
new descriptor   ( 3 ) ----&gt;| file                  |
                  ---       +-----------------------+</pre>

</p>

<p>
What will the command do with this descriptor?  It depends. Often nothing.
We will see later why we might want other file descriptors.
</p>

</div>
<!-- EDIT{&quot;target&quot;:&quot;section&quot;,&quot;name&quot;:&quot;Output Redirection \&quot;n&gt; file\&quot;&quot;,&quot;hid&quot;:&quot;output_redirection_n_file&quot;,&quot;codeblockOffset&quot;:2,&quot;secid&quot;:4,&quot;range&quot;:&quot;1939-4030&quot;} -->
<h2 class="sectionedit5" id="input_redirection_n_file">Input Redirection &quot;n&lt; file&quot;</h2>
<div class="level2">

<p>
When you run a commandusing <code>command &lt; file</code>, it changes the
file descriptor <code>0</code> so that it looks like:
</p>

<p>
<pre class="code">                  ---       +-----------------------+
standard input   ( 0 ) &lt;----| file                  |
                  ---       +-----------------------+

                  ---       +-----------------------+
standard output  ( 1 ) ----&gt;| /dev/pts/5            |
                  ---       +-----------------------+

                  ---       +-----------------------+
standard error   ( 2 ) ----&gt;| /dev/pts/5            |
                  ---       +-----------------------+</pre>

</p>

<p>
If the command reads from <code>stdin</code>, it now will read from <code>file</code> and not
from the console.
</p>

<p>
As with <code>&gt;</code>, <code>&lt;</code> can be used to open a new file descriptor for reading,
<code>command 3&lt;file</code>. Later we will see how this can be useful.
</p>

</div>
<!-- EDIT{&quot;target&quot;:&quot;section&quot;,&quot;name&quot;:&quot;Input Redirection \&quot;n&lt; file\&quot;&quot;,&quot;hid&quot;:&quot;input_redirection_n_file&quot;,&quot;codeblockOffset&quot;:4,&quot;secid&quot;:5,&quot;range&quot;:&quot;4031-4919&quot;} -->
<h2 class="sectionedit6" id="pipes">Pipes |</h2>
<div class="level2">

<p>
What does this <code>|</code> do? Among other things, it connects the standard output of
the command on the left to the standard input of the command on the right.
That is, it creates a special file, a pipe, which is opened as a write destinaton
for the left command, and as a read source for the right command.
</p>

<p>
<pre class="code">           echo foo               |                cat

 ---       +--------------+               ---       +--------------+
( 0 ) ----&gt;| /dev/pts/5   |     ------&gt;  ( 0 ) ----&gt;|pipe (read)   |
 ---       +--------------+    /          ---       +--------------+
                              /
 ---       +--------------+  /            ---       +--------------+
( 1 ) ----&gt;| pipe (write) | /            ( 1 ) ----&gt;| /dev/pts     |
 ---       +--------------+               ---       +--------------+

 ---       +--------------+               ---       +--------------+
( 2 ) ----&gt;| /dev/pts/5   |              ( 2 ) ----&gt;| /dev/pts/    |
 ---       +--------------+               ---       +--------------+
</pre>

</p>

<p>
This is possible because the redirections are set up by the shell
<strong>before</strong> the commands are executed, and the commands inherit the file
descriptors.
</p>

</div>
<!-- EDIT{&quot;target&quot;:&quot;section&quot;,&quot;name&quot;:&quot;Pipes |&quot;,&quot;hid&quot;:&quot;pipes&quot;,&quot;codeblockOffset&quot;:5,&quot;secid&quot;:6,&quot;range&quot;:&quot;4920-6123&quot;} -->
<h1 class="sectionedit7" id="more_on_file_descriptors">More On File Descriptors</h1>
<div class="level1">

</div>
<!-- EDIT{&quot;target&quot;:&quot;section&quot;,&quot;name&quot;:&quot;More On File Descriptors&quot;,&quot;hid&quot;:&quot;more_on_file_descriptors&quot;,&quot;codeblockOffset&quot;:6,&quot;secid&quot;:7,&quot;range&quot;:&quot;6124-6162&quot;} -->
<h2 class="sectionedit8" id="duplicating_file_descriptor_2_1">Duplicating File Descriptor 2&gt;&amp;1</h2>
<div class="level2">

<p>
We have seen how to open (or redirect) file descriptors. Let us see
how to duplicate them, starting with the classic <code>2&gt;&amp;1</code>.  What does this
mean? That something written on the file descriptor <code>2</code> will go where
file descriptor <code>1</code> goes. In a shell <code>command 2&gt;&amp;1</code> is not a very
interesting example so we will use <code>ls /tmp/ doesnotexist 2&gt;&amp;1 | less</code>
</p>

<p>
<pre class="code">   ls /tmp/ doesnotexist 2&gt;&amp;1     |                   less

 ---       +--------------+              ---       +--------------+
( 0 ) ----&gt;| /dev/pts/5   |     ------&gt; ( 0 ) ----&gt;|from the pipe |
 ---       +--------------+    /   ---&gt;  ---       +--------------+
                              /   /
 ---       +--------------+  /   /       ---       +--------------+
( 1 ) ----&gt;| to the pipe  | /   /       ( 1 ) ----&gt;|  /dev/pts    |
 ---       +--------------+    /         ---       +--------------+
      	       	       	      /
 ---       +--------------+  /           ---       +--------------+
( 2 ) ----&gt;|  to the pipe | /           ( 2 ) ----&gt;| /dev/pts/    |
 ---       +--------------+              ---       +--------------+</pre>

</p>

<p>
Why is it called <em>duplicating</em>? Because after <code>2&gt;&amp;1</code>, we have 2 file
descriptors pointing to the same file. Take care not to call this
&quot;File Descriptor Aliasing&quot;; if we redirect <code>stdout</code> after <code>2&gt;&amp;1</code> to a
file <code>B</code>, file descriptor <code>2</code> will still be opened on the file <code>A</code> where it was.  This is
often misunderstood by people wanting to redirect both standard input
and standard output to the file. Continue reading for more on this.
</p>

<p>
So if you have two file descriptors <code>s</code> and <code>t</code> like:
<pre class="code">                  ---       +-----------------------+
 a descriptor    ( s ) ----&gt;| /some/file            |
                  ---       +-----------------------+
                  ---       +-----------------------+
 a descriptor    ( t ) ----&gt;| /another/file         |
                  ---       +-----------------------+</pre>

</p>

<p>
Using a <code>t&gt;&amp;s</code> (where <code>t</code> and <code>s</code> are numbers) it means: 
</p>
<blockquote><div class="no">
 Copy whatever file descriptor <code>s</code> contains into file descriptor <code>t</code></div></blockquote>

<p>
So you got a copy of this descriptor:
</p>

<p>
<pre class="code">                  ---       +-----------------------+
 a descriptor    ( s ) ----&gt;| /some/file            |
                  ---       +-----------------------+
                  ---       +-----------------------+
 a descriptor    ( t ) ----&gt;| /some/file            |
                  ---       +-----------------------+</pre>

</p>

<p>
Internally each of these is represented by a file descriptor opened by the operating system&#039;s <code>fopen</code> calls, and is likely just a pointer to the file which has been opened for reading (<code>stdin</code> or file descriptor <code>0</code>) or writing (<code>stdout</code> /<code>stderr</code>). 
</p>

<p>
Note that the file reading or writing positions are also duplicated. If you have already
read a line of <code>s</code>, then after <code>t&gt;&amp;s</code> if you read a line from <code>t</code>, you will
get the second line of the file. 
</p>

<p>
Similarly for output file descriptors, writing a line to file descriptor <code>s</code> will append a line to a file as will writing a line to file descriptor <code>t</code>.
</p>
<div class="plugin_note notetip">The syntax is somewhat confusing in that you would think that the arrow would point in the direction of the copy, but it&#039;s reversed. So it&#039;s <code>target&gt;&amp;source</code> effectively.
</div>
<p>
So, as a simple example (albeit slightly contrived), is the following:
</p>

<p>
<pre class="code">exec 3&gt;&amp;1         # Copy 1 into 3
exec 1&gt; logfile   # Make 1 opened to write to logfile
lotsa_stdout      # Outputs to fd 1, which writes to logfile
exec 1&gt;&amp;3         # Copy 3 back into 1
echo Done         # Output to original stdout</pre>

</p>

</div>
<!-- EDIT{&quot;target&quot;:&quot;section&quot;,&quot;name&quot;:&quot;Duplicating File Descriptor 2&gt;&amp;1&quot;,&quot;hid&quot;:&quot;duplicating_file_descriptor_2_1&quot;,&quot;codeblockOffset&quot;:6,&quot;secid&quot;:8,&quot;range&quot;:&quot;6163-9827&quot;} -->
<h2 class="sectionedit9" id="order_of_redirection_ie_file_2_1_vs_2_1_file">Order Of Redirection, i.e., &quot;&gt; file 2&gt;&amp;1&quot; vs. &quot;2&gt;&amp;1 &gt;file&quot;</h2>
<div class="level2">

<p>
While it doesn&#039;t matter where the redirections appears on the command
line, their order does matter. They are set up from left to right.
</p>
<ul>
<li class="level1"><div class="li"> <code>2&gt;&amp;1 &gt;file</code></div>
</li>
</ul>

<p>
A common error, is to do <code>command 2&gt;&amp;1 &gt; file</code> to redirect both <code>stderr</code>
and <code>stdout</code> to <code>file</code>. Let&#039;s see what&#039;s going on. First we type the
command in our terminal, the descriptors look like this:
</p>

<p>
<pre class="code">                  ---       +-----------------------+
standard input   ( 0 ) ----&gt;| /dev/pts/5            |
                  ---       +-----------------------+

                  ---       +-----------------------+
standard output  ( 1 ) ----&gt;| /dev/pts/5            |
                  ---       +-----------------------+

                  ---       +-----------------------+
standard error   ( 2 ) ----&gt;| /dev/pts/5            |
                  ---       +-----------------------+</pre>

</p>

<p>
Then our shell, Bash sees <code>2&gt;&amp;1</code> so it duplicates 1, and the file
descriptor look like this:
</p>

<p>
<pre class="code">                  ---       +-----------------------+
standard input   ( 0 ) ----&gt;| /dev/pts/5            |
                  ---       +-----------------------+

                  ---       +-----------------------+
standard output  ( 1 ) ----&gt;| /dev/pts/5            |
                  ---       +-----------------------+

                  ---       +-----------------------+
standard error   ( 2 ) ----&gt;| /dev/pts/5            |
                  ---       +-----------------------+</pre>

</p>

<p>
That&#039;s right, nothing has changed, 2 was already pointing to the same
place as 1. Now Bash sees <code>&gt; file</code> and thus changes <code>stdout</code>:
</p>

<p>
<pre class="code">                  ---       +-----------------------+
standard input   ( 0 ) ----&gt;| /dev/pts/5            |
                  ---       +-----------------------+

                  ---       +-----------------------+
standard output  ( 1 ) ----&gt;| file                  |
                  ---       +-----------------------+

                  ---       +-----------------------+
standard error   ( 2 ) ----&gt;| /dev/pts/5            |
                  ---       +-----------------------+</pre>

</p>

<p>
And that&#039;s not what we want.
</p>
<ul>
<li class="level1"><div class="li"> <code>&gt;file 2&gt;&amp;1</code></div>
</li>
</ul>

<p>
Now let&#039;s look at the correct <code>command &gt;file 2&gt;&amp;1</code>. We start as in the
previous example, and Bash sees <code>&gt; file</code>:
</p>

<p>
<pre class="code">                  ---       +-----------------------+
standard input   ( 0 ) ----&gt;| /dev/pts/5            |
                  ---       +-----------------------+

                  ---       +-----------------------+
standard output  ( 1 ) ----&gt;| file                  |
                  ---       +-----------------------+

                  ---       +-----------------------+
standard error   ( 2 ) ----&gt;| /dev/pts/5            |
                  ---       +-----------------------+</pre>

</p>

<p>
Then it sees our duplication <code>2&gt;&amp;1</code>:
</p>

<p>
<pre class="code">                  ---       +-----------------------+
standard input   ( 0 ) ----&gt;| /dev/pts/5            |
                  ---       +-----------------------+

                  ---       +-----------------------+
standard output  ( 1 ) ----&gt;| file                  |
                  ---       +-----------------------+

                  ---       +-----------------------+
standard error   ( 2 ) ----&gt;| file                  |
                  ---       +-----------------------+</pre>

</p>

<p>
And voila, both <code>1</code> and <code>2</code> are redirected to file.
</p>

</div>
<!-- EDIT{&quot;target&quot;:&quot;section&quot;,&quot;name&quot;:&quot;Order Of Redirection, i.e., \&quot;&gt; file 2&gt;&amp;1\&quot; vs. \&quot;2&gt;&amp;1 &gt;file\&quot;&quot;,&quot;hid&quot;:&quot;order_of_redirection_ie_file_2_1_vs_2_1_file&quot;,&quot;codeblockOffset&quot;:10,&quot;secid&quot;:9,&quot;range&quot;:&quot;9828-13283&quot;} -->
<h2 class="sectionedit10" id="why_sed_sfoobarfile_file_doesn_t_work">Why sed &#039;s/foo/bar/&#039; file &gt;file Doesn&#039;t Work</h2>
<div class="level2">

<p>
This is a common error, we want to modify a file using something that
reads from a file and writes the result to <code>stdout</code>. To do this, we redirect stdout
to the file we want to modify. The problem here is that, as we
have seen, the redirections are setup before the command is actually
executed.
</p>

<p>
So <strong>BEFORE</strong> sed starts, standard output has already been redirected, with
the additional side effect that, because we used &gt;, &quot;file&quot; gets truncated. When <code>sed</code> starts to
read the file, it contains nothing.
</p>

</div>
<!-- EDIT{&quot;target&quot;:&quot;section&quot;,&quot;name&quot;:&quot;Why sed &#039;s\/foo\/bar\/&#039; file &gt;file Doesn&#039;t Work&quot;,&quot;hid&quot;:&quot;why_sed_sfoobarfile_file_doesn_t_work&quot;,&quot;codeblockOffset&quot;:15,&quot;secid&quot;:10,&quot;range&quot;:&quot;13284-13852&quot;} -->
<h2 class="sectionedit11" id="exec">exec</h2>
<div class="level2">

<p>
In Bash the <code>exec</code> built-in replaces the shell with the specified
program. So what does this have to do with redirection?
<code>exec</code> also allow us to manipulate the file descriptors.
If you don&#039;t specify a program, the redirection after <code>exec</code> modifies the
file descriptors of the current shell.
</p>

<p>
For example, all the commands after <code>exec 2&gt;file</code> will have file
descriptors like:
<pre class="code">                  ---       +-----------------------+
standard input   ( 0 ) ----&gt;| /dev/pts/5            |
                  ---       +-----------------------+

                  ---       +-----------------------+
standard output  ( 1 ) ----&gt;| /dev/pts/5            |
                  ---       +-----------------------+

                  ---       +-----------------------+
standard error   ( 2 ) ----&gt;| file	            |
                  ---       +-----------------------+</pre>

</p>

<p>
All the the errors sent to <code>stderr</code> by the commands after the <code>exec 2&gt;file</code>
will go to the file, just as if you had the command in a script and
ran <code>myscript 2&gt;file</code>.
</p>

<p>
<code>exec</code> can be used, if, for instance, you want to log the errors the
commands in your script produce, just add <code>exec 2&gt;myscript.errors</code> at
the beginning of your script.
</p>

<p>
Let&#039;s see another use case. We want to read a file line by line, this
is easy, we just do:
</p>

<p>
<pre class="code"> while read -r line;do echo &quot;$line&quot;;done &lt; file</pre>

</p>

<p>
Now, we want, after printing each line, to do a pause, waiting for
the user to press a key:
</p>

<p>
<pre class="code"> while read -r line;do echo &quot;$line&quot;; read -p &quot;Press any key&quot; -n 1;done &lt; file</pre>

</p>

<p>
And, surprise this doesn&#039;t work. Why? because the shell descriptor of
the while loop looks like:
</p>

<p>
<pre class="code">                  ---       +-----------------------+
standard input   ( 0 ) ----&gt;| file                  |
                  ---       +-----------------------+

                  ---       +-----------------------+
standard output  ( 1 ) ----&gt;| /dev/pts/5            |
                  ---       +-----------------------+

                  ---       +-----------------------+
standard error   ( 2 ) ----&gt;| /dev/pts/5            |
                  ---       +-----------------------+</pre>

</p>

<p>
and our read inherits these descriptors, and our command (<code>read -p &quot;Press any key&quot; -n 1</code>)
inherits them, and thus reads from file and not from our terminal.
</p>

<p>
A quick look at <code>help read</code> tells us that we can specify a file
descriptor from which <code>read</code> should read. Cool. Now let&#039;s use <code>exec</code> to
get another descriptor:
</p>

<p>
<pre class="code"> exec 3&lt;file
 while read -u 3 line;do echo &quot;$line&quot;; read -p &quot;Press any key&quot; -n 1;done</pre>

</p>

<p>
Now the file descriptors look like:
</p>

<p>
<pre class="code">                  ---       +-----------------------+
standard input   ( 0 ) ----&gt;| /dev/pts/5            |
                  ---       +-----------------------+

                  ---       +-----------------------+
standard output  ( 1 ) ----&gt;| /dev/pts/5            |
                  ---       +-----------------------+

                  ---       +-----------------------+
standard error   ( 2 ) ----&gt;| /dev/pts/5            |
                  ---       +-----------------------+

                  ---       +-----------------------+
new descriptor   ( 3 ) ----&gt;| file                  |
                  ---       +-----------------------+</pre>

</p>

<p>
and it works.
</p>

</div>
<!-- EDIT{&quot;target&quot;:&quot;section&quot;,&quot;name&quot;:&quot;exec&quot;,&quot;hid&quot;:&quot;exec&quot;,&quot;codeblockOffset&quot;:15,&quot;secid&quot;:11,&quot;range&quot;:&quot;13853-17195&quot;} -->
<h2 class="sectionedit12" id="closing_the_file_descriptors">Closing The File Descriptors</h2>
<div class="level2">

<p>
Closing a file through a file descriptor is easy, just make it a duplicate of  -.
For instance, let&#039;s close <code>stdin &lt;&amp;-</code> and <code>stderr 2&gt;&amp;-</code>:
</p>

<p>
<pre class="code"> bash -c &#039;{ lsof -a -p $$ -d0,1,2 ;} &lt;&amp;- 2&gt;&amp;-&#039;
 COMMAND   PID USER   FD   TYPE DEVICE SIZE NODE NAME
 bash    10668 pgas    1u   CHR  136,2         4 /dev/pts/2</pre>

we see that inside the <code>{}</code> that only <code>1</code> is still here.
</p>

<p>
Though the <abbr title="Operating System">OS</abbr> will probably clean up the mess, it is perhaps a
good idea to close the file descriptors you open. For instance, if you
open a file descriptor with <code>exec 3&gt;file</code>, all the commands afterwards
will inherit it. It&#039;s probably better to do something like:
</p>

<p>
<pre class="code">exec 3&gt;file
.....
#commands that uses 3
.....
exec 3&gt;&amp;-

#we don&#039;t need 3 any more</pre>

</p>

<p>
I&#039;ve seen some people using this as a way to discard, say stderr, using something like: command 2&gt;&amp;-.
Though it might work, I&#039;m not sure if you can expect all applications to behave correctly with a closed stderr.
</p>

<p>
When in doubt, I use 2&gt;/dev/null.
</p>

</div>
<!-- EDIT{&quot;target&quot;:&quot;section&quot;,&quot;name&quot;:&quot;Closing The File Descriptors&quot;,&quot;hid&quot;:&quot;closing_the_file_descriptors&quot;,&quot;codeblockOffset&quot;:21,&quot;secid&quot;:12,&quot;range&quot;:&quot;17196-18238&quot;} -->
<h1 class="sectionedit13" id="an_example">An Example</h1>
<div class="level1">

<p>
This example comes from <a href="http://groups.google.com/group/comp.unix.shell/browse_thread/thread/64206d154894a4ef/ffe4c2e382034ed9#ffe4c2e382034ed9" class="urlextern" title="http://groups.google.com/group/comp.unix.shell/browse_thread/thread/64206d154894a4ef/ffe4c2e382034ed9#ffe4c2e382034ed9" rel="nofollow">this post (ffe4c2e382034ed9)</a> on the comp.unix.shell group:
</p>

<p>
<pre class="code">{
  {
    cmd1 3&gt;&amp;- |
      cmd2 2&gt;&amp;3 3&gt;&amp;-
  } 2&gt;&amp;1 &gt;&amp;4 4&gt;&amp;- |
    cmd3 3&gt;&amp;- 4&gt;&amp;-

} 3&gt;&amp;2 4&gt;&amp;1</pre>

</p>

<p>
The redirections are processed from left to right, but as the file
descriptors are inherited we will also have to work from the outer to
the inner contexts. We will assume that we run this command in a
terminal. Let&#039;s start with the outer <code>{ } 3&gt;&amp;2 4&gt;&amp;1</code>.
</p>

<p>
<pre class="code"> ---       +-------------+    ---       +-------------+
( 0 ) ----&gt;| /dev/pts/5  |   ( 3 ) ----&gt;| /dev/pts/5  |
 ---       +-------------+    ---       +-------------+

 ---       +-------------+    ---       +-------------+
( 1 ) ----&gt;| /dev/pts/5  |   ( 4 ) ----&gt;| /dev/pts/5  |
 ---       +-------------+    ---       +-------------+

 ---       +-------------+
( 2 ) ----&gt;| /dev/pts/5  |
 ---       +-------------+</pre>

</p>

<p>
We only made 2 copies of <code>stderr</code> and <code>stdout</code>. <code>3&gt;&amp;1 4&gt;&amp;1</code> would have
produced the same result here because we ran the command in a terminal
and thus <code>1</code> and <code>2</code> go to the terminal. As an exercise, you can start
with <code>1</code> pointing to <code>file.stdout</code> and 2 pointing to <code>file.stderr</code>, you will
see why these redirections are very nice.
</p>

<p>
Let&#039;s continue with the right part of the second pipe: <code>| cmd3 3&gt;&amp;- 4&gt;&amp;-</code>
</p>

<p>
<pre class="code"> ---       +-------------+
( 0 ) ----&gt;| 2nd pipe    |
 ---       +-------------+

 ---       +-------------+
( 1 ) ----&gt;| /dev/pts/5  |
 ---       +-------------+

 ---       +-------------+
( 2 ) ----&gt;| /dev/pts/5  |
 ---       +-------------+</pre>

</p>

<p>
It inherits the previous file descriptors, closes 3 and 4 and sets up a pipe
for reading. Now for the left part of the second pipe <code>{â€¦}  2&gt;&amp;1 &gt;&amp;4 4&gt;&amp;- |</code>
</p>

<p>
<pre class="code"> ---       +-------------+  ---       +-------------+
( 0 ) ----&gt;| /dev/pts/5  | ( 3 ) ----&gt;| /dev/pts/5  |
 ---       +-------------+  ---       +-------------+

 ---       +-------------+
( 1 ) ----&gt;| /dev/pts/5  |
 ---       +-------------+

 ---       +-------------+
( 2 ) ----&gt;| 2nd pipe    |
 ---       +-------------+</pre>

</p>

<p>
First, The file descriptor <code>1</code> is connected to the pipe (<code>|</code>), then <code>2</code> is
made a copy of <code>1</code> and thus is made an fd to the pipe (<code>2&gt;&amp;1</code>), then <code>1</code> is
made a copy of <code>4</code> (<code>&gt;&amp;4</code>), then <code>4</code> is closed. These are the file
descriptors of the inner <code>{}</code>. Lcet&#039;s go inside and have a look at the
right part of the first pipe: <code>| cmd2 2&gt;&amp;3 3&gt;&amp;-</code>
</p>

<p>
<pre class="code"> ---       +-------------+
( 0 ) ----&gt;| 1st pipe    |
 ---       +-------------+

 ---       +-------------+
( 1 ) ----&gt;| /dev/pts/5  |
 ---       +-------------+

 ---       +-------------+
( 2 ) ----&gt;| /dev/pts/5  |
 ---       +-------------+</pre>

</p>

<p>
It inherits the previous file descriptors, connects 0 to the 1st pipe,
the file descriptor 2 is made a copy of 3, and 3 is closed. Finally, for the left
part of the pipe:
</p>

<p>
<pre class="code"> ---       +-------------+
( 0 ) ----&gt;| /dev/pts/5  |
 ---       +-------------+

 ---       +-------------+
( 1 ) ----&gt;| 1st pipe    |
 ---       +-------------+

 ---       +-------------+
( 2 ) ----&gt;| 2nd pipe    |
 ---       +-------------+</pre>

</p>

<p>
It also inherits the file descriptor of the left part of the 2nd
pipe, file descriptor <code>1</code> is connected to the first pipe, <code>3</code> is closed.
</p>

<p>
The purpose of all this becomes clear if we take only the commands:
</p>

<p>
<pre class="code">                                                   cmd2

                                           ---       +-------------+
				       --&gt;( 0 ) ----&gt;| 1st pipe    |
				      /	   ---       +-------------+
				     /
                                    /	   ---       +-------------+
         cmd 1                	   /	  ( 1 ) ----&gt;| /dev/pts/5  |
				  /	   ---       +-------------+
				 /
 ---       +-------------+	/	   ---       +-------------+
( 0 ) ----&gt;| /dev/pts/5  |     /	  ( 2 ) ----&gt;| /dev/pts/5  |
 ---       +-------------+    /		   ---       +-------------+
			     /
 ---       +-------------+  /                       cmd3
( 1 ) ----&gt;| 1st pipe    | /
 ---       +-------------+                 ---       +-------------+
			     ------------&gt;( 0 ) ----&gt;| 2nd pipe    |
 ---       +-------------+ /               ---       +-------------+
( 2 ) ----&gt;| 2nd pipe    |/
 ---       +-------------+                 ---       +-------------+
			      	    	  ( 1 ) ----&gt;| /dev/pts/5  |
			       	    	   ---       +-------------+

				    	   ---       +-------------+
				       	  ( 2 ) ----&gt;| /dev/pts/5  |
				  	   ---       +-------------+
</pre>

</p>

<p>
As said previously, as an exercise, you can start with <code>1</code> open on a file
and <code>2</code> open on another file to see how the <code>stdin</code> from <code>cmd2</code> and <code>cmd3</code> goes
to the original <code>stdin</code> and how the <code>stderr</code> goes to the original <code>stderr</code>.
</p>

</div>
<!-- EDIT{&quot;target&quot;:&quot;section&quot;,&quot;name&quot;:&quot;An Example&quot;,&quot;hid&quot;:&quot;an_example&quot;,&quot;codeblockOffset&quot;:23,&quot;secid&quot;:13,&quot;range&quot;:&quot;18239-23158&quot;} -->
<h1 class="sectionedit14" id="syntax">Syntax</h1>
<div class="level1">

<p>
I used to have trouble choosing between <code>0&amp;&lt;3</code> <code>3&amp;&gt;1</code> <code>3&gt;&amp;1</code> <code>-&gt;2</code> <code>-&lt;&amp;0</code> <code>&amp;-&lt;0</code>
<code>0&lt;&amp;-</code> etcâ€¦ (I think probably because the syntax is more representative of the result, i.e., the redirection, than
what is done, i.e., opening, closing, or duplicating file descriptors).
</p>

<p>
If this fits your situation, then maybe the following &quot;rules&quot; will help
you, a redirection is always like the following:
</p>

<p>
<pre class="code"> lhs op rhs</pre>

</p>
<ul>
<li class="level1 node"><div class="li"> <code>lhs</code> is always a file description, i.e., a number:</div>
<ul>
<li class="level2"><div class="li"> Either we want to open, duplicate, move or we want to close. If the op is <code>&lt;</code> then there is an implicit 0, if it&#039;s <code>&gt;</code> or <code>&gt;&gt;</code>, there is an implicit 1.</div>
</li>
</ul>
</li>
</ul>
<ul>
<li class="level1 node"><div class="li"> <code>op</code> is <code>&lt;</code>, <code>&gt;</code>, <code>&gt;&gt;</code>, <code>&gt;|</code>, or <code>&lt;&gt;</code>:</div>
<ul>
<li class="level2"><div class="li"> <code>&lt;</code> if the file decriptor in <code>lhs</code> will be read, <code>&gt;</code> if it will be written, <code>&gt;&gt;</code> if data is to be appended to the file, <code>&gt;|</code> to overwrite an existing file  or <code>&lt;&gt;</code> if it will be both read and written.</div>
</li>
</ul>
</li>
</ul>
<ul>
<li class="level1 node"><div class="li"> <code>rhs</code> is the thing that the file descriptor will describe:</div>
<ul>
<li class="level2"><div class="li"> It can be the name of a file, the place where another descriptor goes (<code>&amp;1</code>), or, <code>&amp;-</code>, which will close the file descriptor.</div>
</li>
</ul>
</li>
</ul>

<p>
You might not like this description, and find it a bit incomplete or
inexact, but I think it really helps to easily find that, say <code>&amp;-&gt;0</code> is
incorrect.
</p>

</div>
<!-- EDIT{&quot;target&quot;:&quot;section&quot;,&quot;name&quot;:&quot;Syntax&quot;,&quot;hid&quot;:&quot;syntax&quot;,&quot;codeblockOffset&quot;:30,&quot;secid&quot;:14,&quot;range&quot;:&quot;23159-24559&quot;} -->
<h3 class="sectionedit15" id="a_note_on_style">A note on style</h3>
<div class="level3">

<p>
The shell is pretty loose about what it considers a valid redirect. While opinions probably differ, this author has some (strong) recommendations:
</p>
<ul>
<li class="level1"><div class="li"> <strong>Always</strong> keep redirections &quot;tightly grouped&quot; â€“ that is, <strong>do not</strong> include whitespace anywhere within the redirection syntax except within quotes if required on the RHS (e.g. a filename that contains a space). Since shells fundamentally use whitespace to delimit fields in general, it is visually much clearer for each redirection to be separated by whitespace, but grouped in chunks that contain no unnecessary whitespace.</div>
</li>
</ul>
<ul>
<li class="level1"><div class="li"> <strong>Do</strong> always put a space between each redirection, and between the argument list and the first redirect.</div>
</li>
</ul>
<ul>
<li class="level1"><div class="li"> <strong>Always</strong> place redirections together at the very end of a command after all arguments. Never precede a command with a redirect. Never put a redirect in the middle of the arguments.</div>
</li>
</ul>
<ul>
<li class="level1"><div class="li"> <strong>Never</strong> use the Csh <code>&amp;&gt;foo</code> and <code>&gt;&amp;foo</code> shorthand redirects. Use the long form <code>&gt;foo 2&gt;&amp;1</code>. (see: <a href="/howto/obsolete" class="wikilink2" title="howto:obsolete" rel="nofollow">obsolete</a>)</div>
</li>
</ul>

<p>
<pre class="code"># Good! This is clearly a simple commmand with two arguments and 4 redirections
cmd arg1 arg2 &lt;myFile 3&lt;&amp;1 2&gt;/dev/null &gt;&amp;2

# Good!
{ cmd1 &lt;&lt;&lt;&#039;my input&#039;; cmd2; } &gt;someFile

# Bad. Is the &quot;1&quot; a file descriptor or an argument to cmd? (answer: it&#039;s the FD). Is the space after the herestring part of the input data? (answer: No).
# The redirects are also not delimited in any obvious way.
cmd 2&gt;&amp; 1 &lt;&lt;&lt; stuff

# Hideously Bad. It&#039;s difficult to tell where the redirects are and whether they&#039;re even valid redirects.
# This is in fact one command with one argument, an assignment, and three redirects.
foo=bar&lt;baz bork&lt;&lt;&lt; blarg&gt;bleh</pre>

</p>

</div>
<!-- EDIT{&quot;target&quot;:&quot;section&quot;,&quot;name&quot;:&quot;A note on style&quot;,&quot;hid&quot;:&quot;a_note_on_style&quot;,&quot;codeblockOffset&quot;:31,&quot;secid&quot;:15,&quot;range&quot;:&quot;24560-26235&quot;} -->
<h1 class="sectionedit16" id="conclusion">Conclusion</h1>
<div class="level1">

<p>
I hope this tutorial worked for you.
</p>

<p>
I lied, I did not explain  <code>1&gt;&amp;3-</code>, go check the manual <img src="/lib/images/smileys/icon_wink.gif" class="icon" alt=";-)" />
</p>

<p>
Thanks to StÃ©phane Chazelas from whom I stole both the intro and the
exampleâ€¦.
</p>

<p>
The intro is inspired by this introduction, you&#039;ll find a nice
exercise there too:
</p>
<ul>
<li class="level1"><div class="li">  <a href="http://tldp.org/LDP/abs/html/ioredirintro.html" class="urlextern" title="http://tldp.org/LDP/abs/html/ioredirintro.html" rel="nofollow"> A Detailed Introduction to I/O and I/O Redirection</a></div>
</li>
</ul>

<p>
The last example comes from this post:
</p>
<ul>
<li class="level1"><div class="li">  <a href="http://groups.google.com/group/comp.unix.shell/browse_thread/thread/64206d154894a4ef/ffe4c2e382034ed9#ffe4c2e382034ed9" class="urlextern" title="http://groups.google.com/group/comp.unix.shell/browse_thread/thread/64206d154894a4ef/ffe4c2e382034ed9#ffe4c2e382034ed9" rel="nofollow"> comp.unix.shell: piping stdout and stderr to different processes</a></div>
</li>
</ul>

</div>
<!-- EDIT{&quot;target&quot;:&quot;section&quot;,&quot;name&quot;:&quot;Conclusion&quot;,&quot;hid&quot;:&quot;conclusion&quot;,&quot;codeblockOffset&quot;:32,&quot;secid&quot;:16,&quot;range&quot;:&quot;26236-26875&quot;} -->
<h1 class="sectionedit17" id="see_also">See also</h1>
<div class="level1">
<ul>
<li class="level1"><div class="li"> Internal: <a href="/syntax/redirection" class="wikilink1" title="syntax:redirection"> Redirection syntax overview</a></div>
</li>
</ul>

</div>
<!-- EDIT{&quot;target&quot;:&quot;section&quot;,&quot;name&quot;:&quot;See also&quot;,&quot;hid&quot;:&quot;see_also&quot;,&quot;codeblockOffset&quot;:32,&quot;secid&quot;:17,&quot;range&quot;:&quot;26876-&quot;} --></div>
</body>
</html>
