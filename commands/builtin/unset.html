<!DOCTYPE html>
<html lang="en" dir="ltr">
<head>
  <meta charset="utf-8" />
  <title>commands:builtin:unset</title>
<meta name="generator" content="DokuWiki"/>
<meta name="robots" content="index,follow"/>
<meta name="keywords" content="commands,builtin,unset"/>
<link rel="search" type="application/opensearchdescription+xml" href="/lib/exe/opensearch.php" title="Bash Hackers Wiki"/>
<link rel="start" href="/"/>
<link rel="contents" href="/commands/builtin/unset?do=index" title="Sitemap"/>
<link rel="manifest" href="/lib/exe/manifest.php"/>
<link rel="alternate" type="application/rss+xml" title="Recent Changes" href="/feed.php"/>
<link rel="alternate" type="application/rss+xml" title="Current namespace" href="/feed.php?mode=list&amp;ns=commands:builtin"/>
<link rel="alternate" type="text/html" title="Plain HTML" href="/_export/xhtml/commands/builtin/unset"/>
<link rel="alternate" type="text/plain" title="Wiki Markup" href="/_export/raw/commands/builtin/unset"/>
<link rel="canonical" href="https://wiki.bash-hackers.org/commands/builtin/unset"/>
<link rel="stylesheet" type="text/css" href="/lib/exe/css.php?t=bootstrap3&amp;tseed=54923c3deda180f2db5bd755cd8fbf1a"/>
<!--[if gte IE 9]><!-->
<script type="text/javascript">/*<![CDATA[*/var NS='commands:builtin';var JSINFO = {"updatable":1,"userreplace":1,"default_macro_string":"","plugins":{"edittable":{"default columnwidth":""}},"move_renameokay":false,"isadmin":0,"isauth":0,"id":"commands:builtin:unset","namespace":"commands:builtin","ACT":"export_xhtml","useHeadingNavigation":1,"useHeadingContent":1};
/*!]]>*/</script>
<script type="text/javascript" charset="utf-8" src="/lib/exe/jquery.php?tseed=23f888679b4f1dc26eef34902aca964f"></script>
<script type="text/javascript" charset="utf-8" src="/lib/exe/js.php?t=bootstrap3&amp;tseed=54923c3deda180f2db5bd755cd8fbf1a"></script>
<!--<![endif]-->
</head>
<body>
<div class="dokuwiki export">
<!-- TOC START -->
<div id="dw__toc" class="dw__toc">
<h3 class="toggle">Table of Contents</h3>
<div>

<ul class="toc">
<li class="level1"><div class="li"><a href="#the_unset_builtin_command">The unset builtin command</a></div>
<ul class="toc">
<li class="level2"><div class="li"><a href="#synopsis">Synopsis</a></div></li>
<li class="level2"><div class="li"><a href="#description">Description</a></div>
<ul class="toc">
<li class="level3"><div class="li"><a href="#options">Options</a></div></li>
<li class="level3"><div class="li"><a href="#exit_status">Exit status</a></div></li>
</ul>
</li>
<li class="level2"><div class="li"><a href="#examples">Examples</a></div>
<ul class="toc">
<li class="level3"><div class="li"><a href="#scope">Scope</a></div></li>
<li class="level3"><div class="li"><a href="#args">Args</a></div></li>
</ul>
</li>
<li class="level2"><div class="li"><a href="#portability_considerations">Portability considerations</a></div></li>
<li class="level2"><div class="li"><a href="#see_also">See also</a></div></li>
</ul>
</li>
<li class="level1"><div class="li"><a href="#discussion__section">Discussion</a></div></li>
</ul>
</div>
</div>
<!-- TOC END -->

<h1 class="sectionedit1" id="the_unset_builtin_command">The unset builtin command</h1>
<div class="level1">

</div>
<!-- EDIT{&quot;target&quot;:&quot;section&quot;,&quot;name&quot;:&quot;The unset builtin command&quot;,&quot;hid&quot;:&quot;the_unset_builtin_command&quot;,&quot;codeblockOffset&quot;:0,&quot;secid&quot;:1,&quot;range&quot;:&quot;1-41&quot;} -->
<h2 class="sectionedit2" id="synopsis">Synopsis</h2>
<div class="level2">

<p>
<pre class="code">unset [-f|v] [-n] [NAME ...]</pre>

</p>

</div>
<!-- EDIT{&quot;target&quot;:&quot;section&quot;,&quot;name&quot;:&quot;Synopsis&quot;,&quot;hid&quot;:&quot;synopsis&quot;,&quot;codeblockOffset&quot;:0,&quot;secid&quot;:2,&quot;range&quot;:&quot;42-108&quot;} -->
<h2 class="sectionedit3" id="description">Description</h2>
<div class="level2">

<p>
The <code>unset</code> builtin command is used to unset values and attributes of shell variables and functions.
Without any option, <code>unset</code> tries to unset a variable first, then a function.
</p>

</div>
<!-- EDIT{&quot;target&quot;:&quot;section&quot;,&quot;name&quot;:&quot;Description&quot;,&quot;hid&quot;:&quot;description&quot;,&quot;codeblockOffset&quot;:1,&quot;secid&quot;:3,&quot;range&quot;:&quot;109-317&quot;} -->
<h3 class="sectionedit4" id="options">Options</h3>
<div class="level3">
<div class="table sectionedit5"><table class="inline">
	<thead>
	<tr class="row0">
		<th class="col0 leftalign"> Option  </th><th class="col1 leftalign"> Description                                                                                                     </th>
	</tr>
	</thead>
	<tr class="row1">
		<td class="col0 leftalign"> <code>-f</code>  </td><td class="col1 leftalign"> treats each <code>NAME</code> as a function name                                                                         </td>
	</tr>
	<tr class="row2">
		<td class="col0 leftalign"> <code>-v</code>  </td><td class="col1 leftalign"> treats each <code>NAME</code> as a variable name                                                                         </td>
	</tr>
	<tr class="row3">
		<td class="col0 leftalign"> <code>-n</code>  </td><td class="col1 leftalign"> treats each <code>NAME</code> as a name reference and unsets the variable itself rather than the variable it references  </td>
	</tr>
</table></div>
<!-- EDIT{&quot;target&quot;:&quot;table&quot;,&quot;name&quot;:&quot;&quot;,&quot;hid&quot;:&quot;table&quot;,&quot;secid&quot;:5,&quot;range&quot;:&quot;337-840&quot;} -->
</div>
<!-- EDIT{&quot;target&quot;:&quot;section&quot;,&quot;name&quot;:&quot;Options&quot;,&quot;hid&quot;:&quot;options&quot;,&quot;codeblockOffset&quot;:1,&quot;secid&quot;:4,&quot;range&quot;:&quot;318-841&quot;} -->
<h3 class="sectionedit6" id="exit_status">Exit status</h3>
<div class="level3">
<div class="table sectionedit7"><table class="inline">
	<thead>
	<tr class="row0">
		<th class="col0 leftalign">Status  </th><th class="col1 leftalign">Reason  </th>
	</tr>
	</thead>
	<tr class="row1">
		<td class="col0 leftalign">0    </td><td class="col1 leftalign">no error  </td>
	</tr>
	<tr class="row2">
		<td class="col0 leftalign">!=0  </td><td class="col1 leftalign">invalid option  </td>
	</tr>
	<tr class="row3">
		<td class="col0 leftalign">!=0  </td><td class="col1 leftalign">invalid combination of options (<code>-v</code> <strong>and</strong> <code>-f</code>)  </td>
	</tr>
	<tr class="row4">
		<td class="col0 leftalign">!=0  </td><td class="col1 leftalign">a given <code>NAME</code> is read-only  </td>
	</tr>
</table></div>
<!-- EDIT{&quot;target&quot;:&quot;table&quot;,&quot;name&quot;:&quot;&quot;,&quot;hid&quot;:&quot;table1&quot;,&quot;secid&quot;:7,&quot;range&quot;:&quot;865-1033&quot;} -->
</div>
<!-- EDIT{&quot;target&quot;:&quot;section&quot;,&quot;name&quot;:&quot;Exit status&quot;,&quot;hid&quot;:&quot;exit_status&quot;,&quot;codeblockOffset&quot;:1,&quot;secid&quot;:6,&quot;range&quot;:&quot;842-1034&quot;} -->
<h2 class="sectionedit8" id="examples">Examples</h2>
<div class="level2">

<p>
<pre class="code">unset -v EDITOR</pre>

</p>

<p>
<pre class="code">unset -f myfunc1 myfunc2</pre>

</p>

</div>
<!-- EDIT{&quot;target&quot;:&quot;section&quot;,&quot;name&quot;:&quot;Examples&quot;,&quot;hid&quot;:&quot;examples&quot;,&quot;codeblockOffset&quot;:1,&quot;secid&quot;:8,&quot;range&quot;:&quot;1035-1129&quot;} -->
<h3 class="sectionedit9" id="scope">Scope</h3>
<div class="level3">

<p>
In bash, unset has some interesting properties due to its unique dynamic scope. If a local variable is both declared and unset (by calling unset on the local) from within the same function scope, then the variable appears unset to that scope and all child scopes until either returning from the function, or another local variable of the same name is declared underneath where the original variable was unset. In other words, the variable looks unset to everything until returning from the function in which the variable was set (and unset), at which point variables of the same name from higher scopes are uncovered and accessible once again.
</p>

<p>
If however unset is called from a child scope relative to where a local variable has been set, then the variable of the same name in the next-outermost scope becomes visible to its scope and all children - as if the variable that was unset was never set to begin with. This property allows looking upwards through the stack as variable names are unset, so long as unset and the local it unsets aren&#039;t together in the same scope level. 
</p>

<p>
Here&#039;s a demonstration of this behavior.
<pre class="code">#!/usr/bin/env bash

FUNCNEST=10

# Direct recursion depth.
# Search up the stack for the first non-FUNCNAME[1] and count how deep we are.
callDepth() {
    # Strip &quot;main&quot; off the end of FUNCNAME[@] if current function is named &quot;main&quot; and
    # Bash added an extra &quot;main&quot; for non-interactive scripts.
    if [[ main == !(!(&quot;${FUNCNAME[1]}&quot;)|!(&quot;${FUNCNAME[-1]}&quot;)) &amp;&amp; $- != *i* ]]; then
        local -a &#039;fnames=(&quot;${FUNCNAME[@]:1:${#FUNCNAME[@]}-2}&quot;)&#039;
    else
        local -a &#039;fnames=(&quot;${FUNCNAME[@]:1}&quot;)&#039;
    fi

    if (( ! ${#fnames[@]} )); then 
        printf 0 
        return
    fi

    local n
    while [[ $fnames == ${fnames[++n]} ]]; do
        :
    done

    printf -- $n
}

# This function is the magic stack walker.
unset2() {
    unset -v -- &quot;$@&quot;
}

f() {
    local a
    if (( (a=$(callDepth)) &lt;= 4 )); then
        (( a == 1 )) &amp;&amp; unset a
        (( a == 2 )) &amp;&amp; declare -g a=&#039;global scope yo&#039;
        f
    else
        trap &#039;declare -p a&#039; DEBUG
        unset2 a   # declare -- a=&quot;5&quot;
        unset a a  # declare -- a=&quot;4&quot;
        unset a    # declare -- a=&quot;2&quot;
        unset a    # ./unset-tests: line 44: declare: a: not found
        :          # declare -- a=&quot;global scope yo&quot;
    fi
}

a=&#039;global scope&#039;
f

# vim: set fenc=utf-8 ff=unix ts=4 sts=4 sw=4 ft=sh nowrap et:</pre>

output:
<pre class="code">declare -- a=&quot;5&quot;
declare -- a=&quot;4&quot;
declare -- a=&quot;2&quot;
./unset-tests: line 44: declare: a: not found
declare -- a=&quot;global scope yo&quot;</pre>

</p>

<p>
Some things to observe:
</p>
<ul>
<li class="level1"><div class="li"> <code>unset2</code> is only really needed once. We remain 5 levels deep in <code>f</code>&#039;s for the remaining <code>unset</code> calls, which peel away the outer layers of <code>a</code>&#039;s.</div>
</li>
<li class="level1"><div class="li"> Notice that the &quot;a&quot; is unset using an ordinary unset command at recursion depth 1, and subsequently calling unset reveals a again in the global scope, which has since been modified in a lower scope using declare -g.</div>
</li>
<li class="level1"><div class="li"> Declaring a global with declare -g bypasses all locals and sets or modifies the variable of the global scope (outside of all functions). It has no affect on the visibility of the global.</div>
</li>
<li class="level1"><div class="li"> This doesn&#039;t apply to individual array elements. If two local arrays of the same name appear in different scopes, the entire array of the inner scope needs to be unset before any elements of the outer array become visible. This makes &quot;unset&quot; and &quot;unset2&quot; identical for individual array elements, and for arrays as a whole, unset and unset2 behave as they do for scalar variables.</div>
</li>
</ul>

</div>
<!-- EDIT{&quot;target&quot;:&quot;section&quot;,&quot;name&quot;:&quot;Scope&quot;,&quot;hid&quot;:&quot;scope&quot;,&quot;codeblockOffset&quot;:3,&quot;secid&quot;:9,&quot;range&quot;:&quot;1130-4706&quot;} -->
<h3 class="sectionedit10" id="args">Args</h3>
<div class="level3">

<p>
Like several other Bash builtins that take parameter names, unset expands its arguments.
<pre class="code"> ~ $ ( a=({a..d}); unset &#039;a[2]&#039;; declare -p a )
declare -a a=&#039;([0]=&quot;a&quot; [1]=&quot;b&quot; [3]=&quot;d&quot;)&#039;</pre>

</p>

<p>
As usual in such cases, it&#039;s important to quote the args to avoid accidental results such as globbing.
<pre class="code"> ~ $ ( a=({a..d}) b=a c=d d=1; set -x; unset &quot;${b}[&quot;{2..3}-c\]; declare -p a )
+ unset &#039;a[2-1]&#039; &#039;a[3-1]&#039;
+ declare -p a
declare -a a=&#039;([0]=&quot;a&quot; [3]=&quot;d&quot;)&#039;</pre>

Of course hard to follow indirection is still possible whenever arithmetic is involved, also as shown above, even without extra expansions.
</p>

<p>
In Bash, the <code>unset</code> builtin only evaluates array subscripts if the array itself is set.
</p>

<p>
<pre class="code"> ~ $ ( unset -v &#039;a[$(echo a was set &gt;&amp;2)0]&#039; )
 ~ $ ( a=(); unset -v &#039;a[$(echo a was set &gt;&amp;2)0]&#039; )
a was set</pre>

</p>

</div>
<!-- EDIT{&quot;target&quot;:&quot;section&quot;,&quot;name&quot;:&quot;Args&quot;,&quot;hid&quot;:&quot;args&quot;,&quot;codeblockOffset&quot;:5,&quot;secid&quot;:10,&quot;range&quot;:&quot;4707-5543&quot;} -->
<h2 class="sectionedit11" id="portability_considerations">Portability considerations</h2>
<div class="level2">

<p>
Quoting POSIX:
<pre class="code">If neither -f nor -v is specified, name refers to a variable; if a variable by that name does not exist, it is unspecified whether a function by that name, if any, shall be unset.</pre>

Therefore, it is recommended to explicitly specify <code>-f</code> or <code>-v</code> when using <code>unset</code>. Also, I prefer it as a matter of style.
</p>

</div>
<!-- EDIT{&quot;target&quot;:&quot;section&quot;,&quot;name&quot;:&quot;Portability considerations&quot;,&quot;hid&quot;:&quot;portability_considerations&quot;,&quot;codeblockOffset&quot;:8,&quot;secid&quot;:11,&quot;range&quot;:&quot;5544-5922&quot;} -->
<h2 class="sectionedit12" id="see_also">See also</h2>
<div class="level2">
<ul>
<li class="level1"><div class="li"> <a href="/commands/builtin/declare" class="wikilink1" title="commands:builtin:declare">The declare builtin command</a></div>
</li>
<li class="level1"><div class="li"> <span class="curid"><a href="/commands/builtin/unset" class="wikilink1" title="commands:builtin:unset">The unset builtin command</a></span></div>
</li>
<li class="level1"><div class="li"> <a href="http://pubs.opengroup.org/onlinepubs/9699919799/utilities/V3_chap02.html#tag_18_29" class="urlextern" title="http://pubs.opengroup.org/onlinepubs/9699919799/utilities/V3_chap02.html#tag_18_29" rel="nofollow"> POSIX &#039;&#039;unset&#039;&#039; utility</a></div>
</li>
</ul>

</div>
<!-- EDIT{&quot;target&quot;:&quot;section&quot;,&quot;name&quot;:&quot;See also&quot;,&quot;hid&quot;:&quot;see_also&quot;,&quot;codeblockOffset&quot;:9,&quot;secid&quot;:12,&quot;range&quot;:&quot;5923-&quot;} --></div>
</body>
</html>
